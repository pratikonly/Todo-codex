generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Mood {
  focused
  average
  tired
}

model User {
  id           String         @id @default(uuid()) @db.Uuid
  email        String         @unique
  fullName     String?
  avatarUrl    String?
  isPublic     Boolean        @default(true)
  role         String         @default("student")
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  studyLogs    StudyLog[]
  streaks      Streak[]
  achievements Achievement[]
  notifications Notification[]

  @@map("users")
}

model StudyLog {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String?  @db.Uuid
  subject   String
  duration  Int
  date      DateTime
  notes     String   @default("")
  mood      Mood
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, date(sort: Desc)])
  @@map("study_logs")
}

model Streak {
  id            String   @id @default(uuid()) @db.Uuid
  userId        String   @db.Uuid
  currentStreak Int      @default(0)
  maxStreak     Int      @default(0)
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("streaks")
}

model Achievement {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @db.Uuid
  badge     String
  awardedAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("achievements")
}

model Friend {
  id           String   @id @default(uuid()) @db.Uuid
  userId       String   @db.Uuid
  friendUserId String   @db.Uuid
  createdAt    DateTime @default(now())

  @@map("friends")
}

model Notification {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @db.Uuid
  title     String
  body      String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt(sort: Desc)])
  @@map("notifications")
}
